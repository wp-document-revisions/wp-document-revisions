(function(){"use strict";const t=3600,e=86400;class i{hasUpload=!1;secure="https:"===window.location.protocol;window=window.dialogArguments||opener||parent||top;autosaveEnableButtonsOriginal=void 0;constructor(t){this.$=t,this.$(".revision").click(this.restoreRevision),this.$("#override_link").click(this.overrideLock),this.$("#document a").click(this.requestPermission),this.$(document).bind("autosaveComplete",this.postAutosaveCallback),this.$(document).bind("documentUpload",this.legacyPostDocumentUpload),this.$(":button, :submit","#submitpost").prop("disabled",!0),this.$("#misc-publishing-actions a").click(this.enableSubmit),this.$("input, select").on("change",this.enableSubmit),this.$("input[type=text], textarea").on("keyup",this.enableSubmit),this.$("#sample-permalink").on("change",this.enableSubmit),this.$("#content-add_media").click(this.cookieFalse),this.$("#postimagediv .inside").click(this.cookieTrue),this.$("#publishing-action").click(this.buildContent),this.$("#submitdiv .inside").click(this.cookieDelete),this.$("#adminmenumain").click(this.cookieDelete),this.$("#wpadminbar").click(this.cookieDelete),this.$("#document").show(),this.$("#revision-log").show(),this.$("#revision-summary").hide(),this.bindPostDocumentUploadCB(),this.hijackAutosave(),this.checkUpdate(),setInterval(this.updateTimestamps,6e4),setInterval(this.checkUpdate,1e3)}hijackAutosave=()=>{this.autosaveEnableButtonsOriginal=window.autosave_enable_buttons,window.autosave_enable_buttons=this.autosaveEnableButtons};autosaveEnableButtons=()=>{if(this.window.document.$(document).trigger("autosaveComplete"),this.hasUpload)return this.autosaveEnableButtonsOriginal()};enableSubmit=()=>(this.$("#revision-summary").show(),this.$(":button, :submit","#submitpost").removeAttr("disabled"),this.$("#lock_override").prev().fadeIn());restoreRevision=t=>{if(t.preventDefault(),confirm(wp_document_revisions.restoreConfirmation))return window.location.href=this.$(t.target).attr("href")};overrideLock=()=>this.$.post(ajaxurl,{action:"override_lock",post_id:this.$("#post_ID").val()||0,nonce:wp_document_revisions.nonce},t=>t?(this.$("#lock_override").hide(),this.$(".error").not("#lock-notice").hide(),this.$("#publish, .add_media, #lock-notice").fadeIn(),autosave()):alert(wp_document_revisions.lockError));requestPermission=()=>{if(null!=window.webkitNotifications)return window.webkitNotifications.requestPermission()};lockOverrideNotice=t=>window.webkitNotifications.checkPermission()>0?window.webkitNotifications.RequestPermission(lock_override_notice):window.webkitNotifications.createNotification(wp_document_revisions.lostLockNoticeLogo,wp_document_revisions.lostLockNoticeTitle,t).show();postAutosaveCallback=()=>{if(this.$("#autosave-alert").length>0&&this.$("#lock-notice").length>0&&this.$("#lock-notice").is(":visible"))return wp_document_revisions.lostLockNotice=wp_document_revisions.lostLockNotice.replace("%s",this.window.document.$("#title").val()),window.webkitNotifications?lock_override_notice(wp_document_revisions.lostLockNotice):alert(wp_document_revisions.lostLockNotice),location.reload(!0)};legacyPostDocumentUpload=(t,e)=>this.postDocumentUpload(t,e);human_time_diff=(i,o)=>{const s=new Date;o=o||s.getTime()/1e3+parseInt(wp_document_revisions.offset);const n=Math.abs(o-i);if(n<=t){let t=Math.floor(n/60);return t=this.roundUp(t),1===t?wp_document_revisions.minute.replace("%d",t):wp_document_revisions.minutes.replace("%d",t)}if(n<=e&&n>t){let e=Math.floor(n/t);return e=this.roundUp(e),1===e?wp_document_revisions.hour.replace("%d",e):wp_document_revisions.hours.replace("%d",e)}if(n>=e){let t=Math.floor(n/e);return t=this.roundUp(t),1===t?wp_document_revisions.day.replace("%d",t):wp_document_revisions.days.replace("%d",t)}return""};roundUp=t=>(t<1&&(t=1),t);bindPostDocumentUploadCB=()=>{if("undefined"!=typeof uploader&&null!==uploader)return uploader.bind("FileUploaded",(t,e,i)=>{if(!i.response.match("media-upload-error"))return this.postDocumentUpload(e.name,i.response)})};cookieFalse=()=>{wpCookies.set("doc_image","false",3600,"/wp-admin",!1,this.secure)};cookieTrue=()=>{wpCookies.set("doc_image","true",3600,"/wp-admin",!1,this.secure),this.$(":button, :submit","#submitpost").removeAttr("disabled")};cookieDelete=()=>{wpCookies.set("doc_image","true",-60,"/wp-admin",!1,this.secure)};updateTimestamps=()=>this.$(".timestamp").each((t,e)=>this.$(e).text(this.human_time_diff(this.$(e).attr("id"))));getDescr=()=>{const t=this.window.document.getElementById("content_ifr");if(null===t){const t=this.$("#post_content").val();return void 0===t||""===t||/^\d+$/.test(t)?"":t}const e=t.contentWindow;if(!e||!e.document){const t=this.$("#post_content").val();return void 0===t||""===t||/^\d+$/.test(t)?"":t}const i=e.document.getElementById("tinymce");if(!i||void 0===i.innerHTML){const t=this.$("#post_content").val();return void 0===t||""===t||/^\d+$/.test(t)?"":t}let o=i.innerHTML;if(void 0===o){const t=this.$("#post_content").val();return""===t||/^\d+$/.test(t)?"":t}return o=o.replace(/<br data-mce-bogus="1">/g,""),o=o.replace(/<br><\/p>/g,"</p>"),o=o.replace(/<p>\s*<\/p>/g,""),o};buildContent=()=>{const t=this.$("#post_content").val();let e,i=this.getDescr();e=""===t?[""]:/^\d+$/.test(t)?["\x3c!-- WPDR "+t+" --\x3e"]:t.match(/<!-- WPDR \s*\d+ -->/)||[""],i=i.replace(/<!-- WPDR \s*\d+ -->/,""),i=e[0]+i,t!==i&&this.enableSubmit(),this.window.jQuery("#curr_content").val(i),this.window.jQuery("#post_content").val(i),this.window.jQuery("#content").val(i)};postDocumentUpload=(t,e)=>{if("string"==typeof e&&-1!==e.indexOf("error"))return this.$(".media-item:first").html(e);if(t instanceof Object&&(t=t.name.split(".").pop()),this.hasUpload)return;if("string"!=typeof e)return;const i=e.match(/\d+$/);if(!i)return;const o=i[0];return this.window.jQuery("#post_content").val("\x3c!-- WPDR "+o+" --\x3e"),this.window.jQuery("#message").hide(),this.hasUpload=!0,this.window.tb_remove(),this.window.jQuery("#post").before(wp_document_revisions.postUploadNotice).prev().fadeIn().fadeOut().fadeIn(),this.enableSubmit(),0!==this.window.jQuery("#sample-permalink").length?this.window.jQuery("#sample-permalink").html(this.window.jQuery("#sample-permalink").html().replace(/\<\/span>(\.[a-z0-9]{1,7})?@$/i,wp_document_revisions.extension)):void 0};checkUpdate=()=>{const t=this.$("#curr_content").val();if(void 0===t)return;const e=this.$("#post_content").val();if("Unset"===t)return this.$(":button, :submit","#submitpost").prop("disabled",!0),void this.$("#curr_content").val(e);this.getDescr()===t&&e===t||(this.buildContent(),this.enableSubmit())}}jQuery(t=>{window.WPDocumentRevisions=new i(t)})}).call(this);